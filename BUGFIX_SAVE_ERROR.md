# ä¿å­˜å·¥ä½œæµé”™è¯¯ä¿®å¤

## é—®é¢˜æè¿°

ä¿å­˜å·¥ä½œæµæ—¶å‡ºç°é”™è¯¯ï¼š
```
Internal C++ object (PySide6.QtWidgets.QLabel) already deleted.
```

## é”™è¯¯åŸå› 

1. **Qtå¯¹è±¡ç”Ÿå‘½å‘¨æœŸç®¡ç†é—®é¢˜**ï¼š
   - åœ¨ `_load_workflows()` æ–¹æ³•ä¸­ï¼Œä½¿ç”¨ `deleteLater()` åˆ é™¤å¸ƒå±€ä¸­çš„æ‰€æœ‰widget
   - åŒ…æ‹¬ `empty_label` ä¹Ÿè¢«åˆ é™¤
   - å½“å†æ¬¡éœ€è¦æ˜¾ç¤º `empty_label` æ—¶ï¼Œå°è¯•è®¿é—®å·²åˆ é™¤çš„Qtå¯¹è±¡

2. **åŒæ­¥åˆ·æ–°é—®é¢˜**ï¼š
   - ä¿å­˜å·¥ä½œæµåç«‹å³åˆ·æ–°é¦–é¡µ
   - åœ¨Qtä¿¡å·å¤„ç†è¿‡ç¨‹ä¸­ç›´æ¥æ“ä½œUIå¯èƒ½å¯¼è‡´å†²çª

## è§£å†³æ–¹æ¡ˆ

### 1. ä¿æŠ¤ `empty_label` ä¸è¢«åˆ é™¤

**ä¿®æ”¹æ–‡ä»¶**ï¼š`src/views/overview_widget.py`

```python
def _load_workflows(self):
    """åŠ è½½å·²ä¿å­˜çš„å·¥ä½œæµ"""
    # ... çœç•¥å‰é¢çš„ä»£ç  ...
    
    # å®‰å…¨åœ°æ¸…ç©ºç°æœ‰å¡ç‰‡
    # å…ˆæ”¶é›†æ‰€æœ‰éœ€è¦åˆ é™¤çš„widgetï¼ˆé™¤äº†empty_labelï¼‰
    widgets_to_remove = []
    for i in range(self.cards_layout.count()):
        item = self.cards_layout.itemAt(i)
        if item:
            widget = item.widget()
            if widget and widget != self.empty_label:
                widgets_to_remove.append(widget)
    
    # ä»å¸ƒå±€ä¸­ç§»é™¤å¹¶åˆ é™¤
    for widget in widgets_to_remove:
        self.cards_layout.removeWidget(widget)
        widget.deleteLater()
```

**å…³é”®ç‚¹**ï¼š
- åœ¨åˆ é™¤å‰å…ˆåˆ¤æ–­æ˜¯å¦æ˜¯ `empty_label`
- åªåˆ é™¤å·¥ä½œæµå¡ç‰‡ï¼Œä¿ç•™ `empty_label`
- `empty_label` åªè¿›è¡Œéšè—/æ˜¾ç¤ºæ“ä½œï¼Œä¸åˆ é™¤

### 2. ä½¿ç”¨å»¶è¿Ÿåˆ·æ–°

**ä¿®æ”¹æ–‡ä»¶**ï¼š`src/views/workflow_tab_widget.py`

```python
def _save_workflow(self):
    """ä¿å­˜å·¥ä½œæµ"""
    try:
        # ... ä¿å­˜é€»è¾‘ ...
        
        # å»¶è¿Ÿåˆ·æ–°é¦–é¡µå·¥ä½œæµåˆ—è¡¨ï¼ˆé¿å…Qtå¯¹è±¡è®¿é—®å†²çªï¼‰
        if self.main_window:
            QTimer.singleShot(100, self._refresh_overview_list)
            
    except Exception as e:
        QMessageBox.critical(self, "ä¿å­˜å¤±è´¥", f"ä¿å­˜å·¥ä½œæµæ—¶å‡ºé”™:\n\n{str(e)}")

def _refresh_overview_list(self):
    """åˆ·æ–°é¦–é¡µå·¥ä½œæµåˆ—è¡¨"""
    try:
        if self.main_window:
            overview_tab = self.main_window.tabs.widget(0)
            if overview_tab and hasattr(overview_tab, 'refresh_workflows'):
                overview_tab.refresh_workflows()
    except Exception as e:
        print(f"åˆ·æ–°é¦–é¡µåˆ—è¡¨å¤±è´¥: {e}")
```

**å…³é”®ç‚¹**ï¼š
- ä½¿ç”¨ `QTimer.singleShot(100, ...)` å»¶è¿Ÿ100æ¯«ç§’æ‰§è¡Œåˆ·æ–°
- å•ç‹¬å°è£…åˆ·æ–°æ–¹æ³• `_refresh_overview_list()`
- æ·»åŠ å¼‚å¸¸å¤„ç†é¿å…åˆ·æ–°å¤±è´¥å½±å“ä¿å­˜

### 3. å®‰å…¨çš„widgetæ£€æŸ¥

```python
# æ£€æŸ¥empty_labelæ˜¯å¦å·²ç»åœ¨å¸ƒå±€ä¸­
if self.empty_label not in [self.cards_layout.itemAt(i).widget() 
                             for i in range(self.cards_layout.count()) 
                             if self.cards_layout.itemAt(i) and self.cards_layout.itemAt(i).widget()]:
    self.cards_layout.addWidget(self.empty_label, 0, 0, Qt.AlignCenter)
```

**å…³é”®ç‚¹**ï¼š
- æ£€æŸ¥widgetæ˜¯å¦å·²å­˜åœ¨äºå¸ƒå±€ä¸­
- é¿å…é‡å¤æ·»åŠ å¯¼è‡´é”™è¯¯
- æ·»åŠ ç©ºå€¼æ£€æŸ¥

## æµ‹è¯•ç»“æœ

è¿è¡Œ `test_save_fix.py`ï¼š

```
============================================================
ä¿å­˜å·¥ä½œæµé”™è¯¯ä¿®å¤æµ‹è¯•
============================================================
æµ‹è¯•1: æ£€æŸ¥æ¨¡å—å¯¼å…¥...
  [OK] æ‰€æœ‰æ¨¡å—å¯¼å…¥æˆåŠŸ

æµ‹è¯•2: æ£€æŸ¥é¦–é¡µåˆ·æ–°é€»è¾‘...
  [OK] åˆå§‹åŠ è½½æˆåŠŸ
  [OK] åˆ·æ–°æ–¹æ³•æˆåŠŸ
  [OK] å¤šæ¬¡åˆ·æ–°æµ‹è¯•é€šè¿‡

æµ‹è¯•3: æ£€æŸ¥å·¥ä½œæµä¿å­˜é€»è¾‘...
  [OK] _refresh_overview_list æ–¹æ³•å­˜åœ¨
  [OK] åˆ·æ–°æ–¹æ³•è°ƒç”¨æˆåŠŸ

============================================================
æµ‹è¯•æ€»ç»“
============================================================
  [PASS]: æ¨¡å—å¯¼å…¥
  [PASS]: é¦–é¡µåˆ·æ–°é€»è¾‘
  [PASS]: å·¥ä½œæµä¿å­˜é€»è¾‘

æ€»è®¡: 3/3 é¡¹æµ‹è¯•é€šè¿‡

[SUCCESS] æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ä¿®å¤æˆåŠŸï¼
```

## ä¿®å¤çš„å…³é”®æŠ€æœ¯ç‚¹

### 1. Qtå¯¹è±¡ç”Ÿå‘½å‘¨æœŸç®¡ç†

åœ¨Qtä¸­ï¼Œä½¿ç”¨ `deleteLater()` åˆ é™¤å¯¹è±¡åï¼Œå¯¹è±¡ä¼šåœ¨ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­è¢«åˆ é™¤ã€‚å¦‚æœåœ¨åˆ é™¤å‰å°è¯•è®¿é—®å¯¹è±¡ï¼Œå°±ä¼šå‡ºç° "Internal C++ object already deleted" é”™è¯¯ã€‚

**æœ€ä½³å®è·µ**ï¼š
- å¯¹äºéœ€è¦é‡å¤ä½¿ç”¨çš„widgetï¼ˆå¦‚ `empty_label`ï¼‰ï¼Œä¸è¦åˆ é™¤å®ƒä»¬
- ä½¿ç”¨ `hide()` / `show()` æ§åˆ¶å¯è§æ€§
- ä½¿ç”¨ `removeWidget()` ä»å¸ƒå±€ä¸­ç§»é™¤ä½†ä¸åˆ é™¤

### 2. Qtä¿¡å·æ§½çš„å¼‚æ­¥å¤„ç†

åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­ç›´æ¥ä¿®æ”¹UIå¯èƒ½å¯¼è‡´å†²çªï¼Œç‰¹åˆ«æ˜¯åœ¨ä¿¡å·é“¾ä¸­ï¼ˆä¿¡å·Aè§¦å‘ä¿¡å·Bï¼Œä¿¡å·Bä¿®æ”¹UIï¼‰ã€‚

**æœ€ä½³å®è·µ**ï¼š
- ä½¿ç”¨ `QTimer.singleShot()` å»¶è¿Ÿæ‰§è¡ŒUIæ›´æ–°
- å°†UIæ“ä½œå°è£…åœ¨ç‹¬ç«‹çš„æ–¹æ³•ä¸­
- æ·»åŠ å¼‚å¸¸å¤„ç†é¿å…é”™è¯¯ä¼ æ’­

### 3. å¸ƒå±€ç®¡ç†çš„å®‰å…¨æ“ä½œ

åœ¨æ¸…ç†å¸ƒå±€æ—¶ï¼Œéœ€è¦å®‰å…¨åœ°éå†å’Œåˆ é™¤itemsã€‚

**æœ€ä½³å®è·µ**ï¼š
```python
# å…ˆæ”¶é›†éœ€è¦åˆ é™¤çš„widgets
widgets_to_remove = []
for i in range(layout.count()):
    item = layout.itemAt(i)
    if item and item.widget():
        widgets_to_remove.append(item.widget())

# å†åˆ é™¤ï¼ˆé¿å…éå†æ—¶ä¿®æ”¹ï¼‰
for widget in widgets_to_remove:
    layout.removeWidget(widget)
    widget.deleteLater()
```

## éªŒè¯æ­¥éª¤

æ‰‹åŠ¨æµ‹è¯•ä¿å­˜åŠŸèƒ½ï¼š

1. å¯åŠ¨åº”ç”¨
2. åˆ›å»ºæ–°å·¥ä½œæµ
3. æ·»åŠ å‡ ä¸ªèŠ‚ç‚¹
4. ç‚¹å‡»"ğŸ’¾ ä¿å­˜"æŒ‰é’®
5. éªŒè¯ï¼š
   - âœ… ä¿å­˜æˆåŠŸæç¤º
   - âœ… æ— é”™è¯¯ä¿¡æ¯
   - âœ… é¦–é¡µè‡ªåŠ¨æ˜¾ç¤ºæ–°å·¥ä½œæµ
6. å†æ¬¡ä¿å­˜å·²ä¿å­˜çš„å·¥ä½œæµ
7. éªŒè¯åˆ·æ–°æ­£å¸¸

## ç›¸å…³æ–‡ä»¶

ä¿®æ”¹çš„æ–‡ä»¶ï¼š
- `src/views/overview_widget.py` - ä¿®å¤ `_load_workflows()` æ–¹æ³•
- `src/views/workflow_tab_widget.py` - æ·»åŠ å»¶è¿Ÿåˆ·æ–°æœºåˆ¶

æµ‹è¯•æ–‡ä»¶ï¼š
- `test_save_fix.py` - è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

## æ€»ç»“

é€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªæ”¹è¿›ï¼ŒæˆåŠŸä¿®å¤äº†ä¿å­˜å·¥ä½œæµæ—¶çš„Qtå¯¹è±¡åˆ é™¤é”™è¯¯ï¼š

1. **ä¿æŠ¤æ°¸ä¹…æ€§widget**ï¼š`empty_label` ä¸å†è¢«åˆ é™¤
2. **å»¶è¿ŸUIåˆ·æ–°**ï¼šä½¿ç”¨ `QTimer.singleShot()` å¼‚æ­¥åˆ·æ–°
3. **å®‰å…¨çš„å¸ƒå±€æ“ä½œ**ï¼šå…ˆæ”¶é›†å†åˆ é™¤ï¼Œé¿å…éå†æ—¶ä¿®æ”¹

è¿™ä¸ªä¿®å¤ä¸ä»…è§£å†³äº†å½“å‰é—®é¢˜ï¼Œè¿˜æé«˜äº†ä»£ç çš„å¥å£®æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚
